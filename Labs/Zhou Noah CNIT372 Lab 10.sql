/*
Noah Zhou
CNIT372 Lab Section 006
Estimated Time Spent: 3 hour
Late hours used: [0]
*/


-- Question #1

CREATE TABLE AIRDB_ALL_INFO AS SELECT * FROM CNIT372TA.AIRDB_ALL_INFO;

/* Q1 Query Results

Table AIRDB_ALL_INFO created.

*/

-- Question #2

ALTER TABLE AIRDB_ALL_INFO
MODIFY (Origin_City_Name VARCHAR2(30 BYTE) NOT NULL,
        Dest_City_Name VARCHAR2(30 BYTE) NOT NULL);

ALTER TABLE AIRDB_ALL_INFO
MODIFY (Origin_State_Nm VARCHAR2(30 BYTE) NOT NULL,
        Dest_State_Nm VARCHAR2(30 BYTE) NOT NULL);

ALTER TABLE AIRDB_ALL_INFO
ADD CONSTRAINT unique_flight_combination UNIQUE (Origin_Airport_ID, Dest_Airport_ID, Fl_Num, Carrier, FL_DATE);

/* Q2 Query Results

Table AIRDB_ALL_INFO altered.


Table AIRDB_ALL_INFO altered.


Table AIRDB_ALL_INFO altered.


*/

-- Question #3

SELECT * FROM User_Constraints WHERE TABLE_NAME ='AIRDB_ALL_INFO';


/* Q3 Query Results

OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
SEARCH_CONDITION_VC
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
ZHOU1170                                                                                                                         SYS_C0039525                                                                                                                     C AIRDB_ALL_INFO                                                                                                                   "ORIGIN_CITY_NAME" IS NOT NULL
"ORIGIN_CITY_NAME" IS NOT NULL
                                                                                                                                                                                                                                                                            ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          19-NOV-24                                                                                                                                                                                                                                                                                                      0

ZHOU1170                                                                                                                         SYS_C0039526                                                                                                                     C AIRDB_ALL_INFO                                                                                                                   "DEST_CITY_NAME" IS NOT NULL
"DEST_CITY_NAME" IS NOT NULL
                                                                                                                                                                                                                                                                            ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          19-NOV-24                                                                                                                                                                                                                                                                                                      0

OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
SEARCH_CONDITION_VC
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------

ZHOU1170                                                                                                                         SYS_C0039527                                                                                                                     C AIRDB_ALL_INFO                                                                                                                   "ORIGIN_STATE_NM" IS NOT NULL
"ORIGIN_STATE_NM" IS NOT NULL
                                                                                                                                                                                                                                                                            ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          19-NOV-24                                                                                                                                                                                                                                                                                                      0

ZHOU1170                                                                                                                         SYS_C0039528                                                                                                                     C AIRDB_ALL_INFO                                                                                                                   "DEST_STATE_NM" IS NOT NULL
"DEST_STATE_NM" IS NOT NULL

OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
SEARCH_CONDITION_VC
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
                                                                                                                                                                                                                                                                            ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          19-NOV-24                                                                                                                                                                                                                                                                                                      0

ZHOU1170                                                                                                                         UNIQUE_FLIGHT_COMBINATION

*/

-- Question #4

CREATE TABLE AIRDB_CLONE AS SELECT * FROM AIRDB_ALL_INFO;

/* Q4 Query Results

Table AIRDB_CLONE created.

*/

-- Question #5

SELECT * FROM User_Constraints WHERE TABLE_NAME ='AIRDB_CLONE';

/* Q5 Query Results

OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
SEARCH_CONDITION_VC
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
ZHOU1170                                                                                                                         SYS_C0039530                                                                                                                     C AIRDB_CLONE                                                                                                                      "ORIGIN_CITY_NAME" IS NOT NULL
"ORIGIN_CITY_NAME" IS NOT NULL
                                                                                                                                                                                                                                                                            ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          19-NOV-24                                                                                                                                                                                                                                                                                                      0

ZHOU1170                                                                                                                         SYS_C0039531                                                                                                                     C AIRDB_CLONE                                                                                                                      "ORIGIN_STATE_NM" IS NOT NULL
"ORIGIN_STATE_NM" IS NOT NULL
                                                                                                                                                                                                                                                                            ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          19-NOV-24                                                                                                                                                                                                                                                                                                      0

OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
SEARCH_CONDITION_VC
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------

ZHOU1170                                                                                                                         SYS_C0039532                                                                                                                     C AIRDB_CLONE                                                                                                                      "DEST_CITY_NAME" IS NOT NULL
"DEST_CITY_NAME" IS NOT NULL
                                                                                                                                                                                                                                                                            ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          19-NOV-24                                                                                                                                                                                                                                                                                                      0

ZHOU1170                                                                                                                         SYS_C0039533                                                                                                                     C AIRDB_CLONE                                                                                                                      "DEST_STATE_NM" IS NOT NULL
"DEST_STATE_NM" IS NOT NULL

OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
SEARCH_CONDITION_VC
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
                                                                                                                                                                                                                                                                            ENABLED  NOT DEFERRABLE IMMEDIATE VALIDATED     GENERATED NAME          19-NOV-24                                                                                                                                                                                                                                                                                                      0
THe constraint that is missing is the previously created unique fight combination constraint that
ensures that the combination of Origin_Airport_ID, Dest_Airport_ID, Fl_Num, Carrier, and Fl_Date is unique:

*/

-- Question #6

ALTER TABLE AIRDB_CLONE
ADD CONSTRAINT unique_flight_combo UNIQUE (Origin_Airport_ID, Dest_Airport_ID, Fl_Num, Carrier, FL_DATE);

/* Q6 Query Results

Table AIRDB_CLONE altered.

*/

-- Question #7

CREATE TABLE AIRDB_AIRPORTS (
    AIRPORT_ID NUMBER,
    CITY_MARKET_ID NUMBER,
    AIRPORT_CODE VARCHAR2(3) PRIMARY KEY,
    CITY_NAME VARCHAR2(30),
    STATE_ABR VARCHAR2(2),
    STATE_FIPS NUMBER,
    STATE_NAME VARCHAR2(30)
);

/* Q7 Query Results

Table AIRDB_AIRPORTS created.

*/

-- Question #8
--Part A
INSERT INTO AIRDB_AIRPORTS (AIRPORT_ID, CITY_MARKET_ID, AIRPORT_CODE, CITY_NAME, STATE_ABR, STATE_FIPS, STATE_NAME)
SELECT ORIGIN_AIRPORT_ID, ORIGIN_CITY_MARKET_ID, ORIGIN, ORIGIN_CITY_NAME, ORIGIN_STATE_ABR, ORIGIN_STATE_FIPS, ORIGIN_STATE_NM
FROM AIRDB_ALL_INFO
UNION ALL
SELECT DEST_AIRPORT_ID, DEST_CITY_MARKET_ID, DEST, DEST_CITY_NAME, DEST_STATE_ABR, DEST_STATE_FIPS, DEST_STATE_NM
FROM AIRDB_ALL_INFO;

--Part B
INSERT INTO AIRDB_AIRPORTS (AIRPORT_ID, CITY_MARKET_ID, AIRPORT_CODE, CITY_NAME, STATE_ABR, STATE_FIPS, STATE_NAME)
SELECT ORIGIN_AIRPORT_ID, ORIGIN_CITY_MARKET_ID, ORIGIN, ORIGIN_CITY_NAME, ORIGIN_STATE_ABR, ORIGIN_STATE_FIPS, ORIGIN_STATE_NM
FROM AIRDB_ALL_INFO
UNION
SELECT DEST_AIRPORT_ID, DEST_CITY_MARKET_ID, DEST, DEST_CITY_NAME, DEST_STATE_ABR, DEST_STATE_FIPS, DEST_STATE_NM
FROM AIRDB_ALL_INFO;



/* Q8 Query Results
--Part A
Error starting at line : 1 in command -
INSERT INTO AIRDB_AIRPORTS (AIRPORT_ID, CITY_MARKET_ID, AIRPORT_CODE, CITY_NAME, STATE_ABR, STATE_FIPS, STATE_NAME)
SELECT ORIGIN_AIRPORT_ID, ORIGIN_CITY_MARKET_ID, ORIGIN, ORIGIN_CITY_NAME, ORIGIN_STATE_ABR, ORIGIN_STATE_FIPS, ORIGIN_STATE_NM
FROM AIRDB_ALL_INFO
UNION ALL
SELECT DEST_AIRPORT_ID, DEST_CITY_MARKET_ID, DEST, DEST_CITY_NAME, DEST_STATE_ABR, DEST_STATE_FIPS, DEST_STATE_NM
FROM AIRDB_ALL_INFO
Error report -
ORA-00001: unique constraint (ZHOU1170.SYS_C0039536) violated

--Part B

294 rows inserted.

The UNION ALL command includes all rows, including duplicates values.
Since there is a unique primary key constraint, having duplicate values violates the constraint.

*/

-- Question #9

ALTER TABLE AIRDB_CLONE
ADD CONSTRAINT fk_origin_airport_code
FOREIGN KEY (Origin)
REFERENCES AIRDB_AIRPORTS (AIRPORT_CODE);

ALTER TABLE AIRDB_CLONE
ADD CONSTRAINT fk_dest_airport_code
FOREIGN KEY (Dest)
REFERENCES AIRDB_AIRPORTS (AIRPORT_CODE);

/* Q9 Query Results

Table AIRDB_CLONE altered.


Table AIRDB_CLONE altered.


*/

-- Question #10

ALTER TABLE AIRDB_CLONE
SET UNUSED (
    Origin_City_Market_ID,
    Origin_State_Fips,
    Dest_City_Market_ID,
    Dest_State_Fips
);


/* Q10 Query Results

Table AIRDB_CLONE altered.

*/

-- Question #11

ALTER TABLE AIRDB_AIRPORTS
ADD CONSTRAINT chk_state_abbreviation
CHECK (state_abr IN (
    'AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',
    'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',
    'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',
    'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',
    'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY'
));

/* Q11 Query Results

Error starting at line : 1 in command -
ALTER TABLE AIRDB_AIRPORTS
ADD CONSTRAINT chk_state_abbreviation
CHECK (state_abr IN (
    'AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',
    'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',
    'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',
    'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',
    'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY'
))
Error report -
ORA-02293: cannot validate (ZHOU1170.CHK_STATE_ABBREVIATION) - check constraint violated
02293. 00000 - "cannot validate (%s.%s) - check constraint violated"
*Cause:    an alter table operation tried to validate a check constraint to
           populated table that had nocomplying values.
*Action:   Obvious

It is possible that there are state abbreviations that have a typo and are not part of the 50 states abbreviations list i.e Puerto Rico (PR).

*/

-- Question #12

ALTER TABLE AIRDB_AIRPORTS
ADD CONSTRAINT chk_state_abbr
CHECK (STATE_ABR IN ('AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',
                     'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',
                     'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',
                     'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',
                     'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY'))
DISABLE;

SELECT * FROM USER_CONSTRAINTS WHERE TABLE_NAME = 'AIRDB_AIRPORTS';

/* Q12 Query Results

Table AIRDB_AIRPORTS altered.

OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
SEARCH_CONDITION_VC
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
ZHOU1170                                                                                                                         CHK_STATE_ABBR                                                                                                                   C AIRDB_AIRPORTS                                                                                                                   STATE_ABR IN ('AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',

STATE_ABR IN ('AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',
                     'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',
                     'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',
                     'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',
                     'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY')

OWNER                                                                                                                            CONSTRAINT_NAME                                                                                                                  C TABLE_NAME                                                                                                                       SEARCH_CONDITION
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- - -------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------
SEARCH_CONDITION_VC
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
R_OWNER                                                                                                                          R_CONSTRAINT_NAME                                                                                                                DELETE_RU STATUS   DEFERRABLE     DEFERRED  VALIDATED     GENERATED      BAD RELY LAST_CHAN INDEX_OWNER                                                                                                                      INDEX_NAME                                                                                                                       INVALID VIEW_RELATED   ORIGIN_CON_ID
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- --------- -------- -------------- --------- ------------- -------------- --- ---- --------- -------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------- -------------- -------------
                                                                                                                                                                                                                                                                            DISABLED NOT DEFERRABLE IMMEDIATE NOT VALIDATED USER NAME               20-NOV-24                                                                                                                                                                                                                                                                                                      0

ZHOU1170                                                                                                                         SYS_C0039536

*/

-- Question #13

DELETE FROM AIRDB_AIRPORTS
WHERE STATE_ABR NOT IN ('AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',
                        'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',
                        'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',
                        'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',
                        'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY');

/* Q13 Query Results

Error starting at line : 1 in command -
DELETE FROM AIRDB_AIRPORTS
WHERE STATE_ABR NOT IN ('AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',
                        'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',
                        'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',
                        'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',
                        'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY')
Error report -
ORA-02292: integrity constraint (ZHOU1170.FK_DEST_AIRPORT_CODE) violated - child record found

The reason why there is an error message is because there are foreign keys that on the AIRDB_CLONE table that reference the
AIRDB_AIRPORT table

*/

-- Question #14

ALTER TABLE AIRDB_CLONE
DROP CONSTRAINT fk_dest_airport_code;

ALTER TABLE AIRDB_CLONE
ADD CONSTRAINT fk_dest_airport_code
FOREIGN KEY (Dest)
REFERENCES AIRDB_AIRPORTS (AIRPORT_CODE)
ON DELETE SET NULL;

/* Q14 Query Results

Table AIRDB_CLONE altered.

Table AIRDB_CLONE altered.

*/

-- Question #15

ALTER TABLE AIRDB_CLONE
DROP CONSTRAINT fk_origin_airport_code;

ALTER TABLE AIRDB_CLONE
ADD CONSTRAINT fk_origin_airport_code
FOREIGN KEY (Origin)
REFERENCES AIRDB_AIRPORTS (AIRPORT_CODE)
ON DELETE CASCADE;

/* Q15 Query Results

Table AIRDB_CLONE altered.

Table AIRDB_CLONE altered.

*/

-- Question #16

DELETE FROM AIRDB_AIRPORTS
WHERE STATE_ABR NOT IN ('AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',
                        'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',
                        'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',
                        'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',
                        'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY');

/* Q16 Query Results

5 rows deleted.

The code now works because the foreign keys have been modified to where for either the origin
or destination airport, having a referenced airport deleted means that all corresponding rows
are either set to null or deleted.

*/

-- Question #17

ALTER TABLE AIRDB_AIRPORTS
ENABLE CONSTRAINT chk_state_abbr;

/* Q17 Query Results

Table AIRDB_AIRPORTS altered.

It works now because the table data has been cleaned and conflicting data that violated the constraint
has been removed.

*/

-- Question #18

SELECT COUNT(*) AS Null_Dest_Airport_ID_Count
FROM AIRDB_CLONE
WHERE Dest_Airport_ID IS NULL;

SELECT COUNT(*) AS Null_Origin_Airport_ID_Count
FROM AIRDB_CLONE
WHERE Origin_Airport_ID IS NULL;

SELECT COUNT(*) AS Null_Dest_Airport_ID_Count
FROM AIRDB_ALL_INFO
WHERE Dest_Airport_ID IS NULL

SELECT COUNT(*) AS Null_Origin_Airport_ID_Count
FROM AIRDB_ALL_INFO
WHERE Origin_Airport_ID IS NULL;

/* Q18 Query Results

NULL_DEST_AIRPORT_ID_COUNT
--------------------------
                         0

NULL_ORIGIN_AIRPORT_ID_COUNT
----------------------------
                           0

NULL_ORIGIN_AIRPORT_ID_COUNT
----------------------------
                           0


NULL_ORIGIN_AIRPORT_ID_COUNT
----------------------------
                           0

I think that On Delete Cascade is the better option so that there is no random data floating around

*/

-- Question #19

ALTER TABLE AIRDB_AIRPORTS
ADD CONSTRAINT unique_airport_code UNIQUE (Airport_Code);

ALTER TABLE AIRDB_AIRPORTS
MODIFY (Airport_Code VARCHAR2(3) NOT NULL);

/* Q19 Query Results

Error starting at line : 1 in command -
ALTER TABLE AIRDB_AIRPORTS
ADD CONSTRAINT unique_airport_code UNIQUE (Airport_Code)
Error report -
ORA-02261: such unique or primary key already exists in the table
02261. 00000 -  "such unique or primary key already exists in the table"
*Cause:    Self-evident.
*Action:   Remove the extra key.

Table AIRDB_AIRPORTS altered.

*/

-- Question #20

ALTER TABLE AIRDB_AIRPORTS
ADD CONSTRAINT unique_city_name UNIQUE (City_Name);

/* Q20 Query Results

Error starting at line : 1 in command -
ALTER TABLE AIRDB_AIRPORTS
ADD CONSTRAINT unique_city_name UNIQUE (City_Name)
Error report -
ORA-02299: cannot validate (ZHOU1170.UNIQUE_CITY_NAME) - duplicate keys found
02299. 00000 - "cannot validate (%s.%s) - duplicate keys found"
*Cause:    an alter table validating constraint failed because the table has
           duplicate key values.
*Action:   Obvious

It failed because there are duplicate key values

*/

-- Question #21

DROP TABLE AIRDB_ALL_INFO CASCADE CONSTRAINTS;
DROP TABLE AIRDB_CLONE CASCADE CONSTRAINTS;
DROP TABLE AIRDB_AIRPORTS CASCADE CONSTRAINTS;
/* Q21 Query Results

DROP TABLE AIRDB_ALL_INFO CASCADE CONSTRAINTS;
DROP TABLE AIRDB_CLONE CASCADE CONSTRAINTS;
DROP TABLE AIRDB_AIRPORTS CASCADE CONSTRAINTS;

*/
